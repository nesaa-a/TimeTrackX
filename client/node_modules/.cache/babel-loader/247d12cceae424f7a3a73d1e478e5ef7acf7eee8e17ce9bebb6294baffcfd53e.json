{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';// Create the AuthContext\nimport{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();// Custom hook to use the auth context\nexport const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};// AuthProvider component\nexport const AuthProvider=_ref=>{let{children}=_ref;const[token,setToken]=useState(localStorage.getItem('token'));const[user,setUser]=useState(null);const[isLoading,setIsLoading]=useState(true);const navigate=useNavigate();// On mount, if token exists, fetch user data\nuseEffect(()=>{const initializeAuth=async()=>{if(token){try{const apiUrl=process.env.REACT_APP_API_URL||'';const response=await axios.get(`${apiUrl}/users/me`,{headers:{Authorization:`Bearer ${token}`}});setUser(response.data);}catch(error){// If fetch fails with 401/403, clear token and localStorage\nif(error.response&&(error.response.status===401||error.response.status===403)){setToken(null);setUser(null);localStorage.removeItem('token');}}}setIsLoading(false);};initializeAuth();},[token]);// Login function\nconst login=newToken=>{setToken(newToken);localStorage.setItem('token',newToken);navigate('/');};// Logout function\nconst logout=()=>{setToken(null);setUser(null);localStorage.removeItem('token');navigate('/login');};// Context value\nconst value={token,user,login,logout,isLoading};// Show loading state while initializing\nif(isLoading){return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',color:'white'},children:/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"})});}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useNavigate","axios","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","token","setToken","localStorage","getItem","user","setUser","isLoading","setIsLoading","navigate","initializeAuth","apiUrl","process","env","REACT_APP_API_URL","response","get","headers","Authorization","data","error","status","removeItem","login","newToken","setItem","logout","value","style","display","justifyContent","alignItems","height","background","color","Provider"],"sources":["C:/Users/Agnesa/OneDrive/Desktop/TimeTrackX/TimeTrackX/client/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\n// Create the AuthContext\r\nexport const AuthContext = createContext();\r\n\r\n// Custom hook to use the auth context\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n// AuthProvider component\r\nexport const AuthProvider = ({ children }) => {\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [user, setUser] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const navigate = useNavigate();\r\n\r\n  // On mount, if token exists, fetch user data\r\n  useEffect(() => {\r\n    const initializeAuth = async () => {\r\n      if (token) {\r\n        try {\r\n          const apiUrl = process.env.REACT_APP_API_URL || '';\r\n          const response = await axios.get(`${apiUrl}/users/me`, {\r\n            headers: { Authorization: `Bearer ${token}` }\r\n          });\r\n          setUser(response.data);\r\n        } catch (error) {\r\n          // If fetch fails with 401/403, clear token and localStorage\r\n          if (error.response && (error.response.status === 401 || error.response.status === 403)) {\r\n            setToken(null);\r\n            setUser(null);\r\n            localStorage.removeItem('token');\r\n          }\r\n        }\r\n      }\r\n      setIsLoading(false);\r\n    };\r\n\r\n    initializeAuth();\r\n  }, [token]);\r\n\r\n  // Login function\r\n  const login = (newToken) => {\r\n    setToken(newToken);\r\n    localStorage.setItem('token', newToken);\r\n    navigate('/');\r\n  };\r\n\r\n  // Logout function\r\n  const logout = () => {\r\n    setToken(null);\r\n    setUser(null);\r\n    localStorage.removeItem('token');\r\n    navigate('/login');\r\n  };\r\n\r\n  // Context value\r\n  const value = {\r\n    token,\r\n    user,\r\n    login,\r\n    logout,\r\n    isLoading\r\n  };\r\n\r\n  // Show loading state while initializing\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        height: '100vh',\r\n        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\r\n        color: 'white'\r\n      }}>\r\n        <div>Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}